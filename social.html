<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social | Luke Schwaninger</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
  <span class="noise-overlay" aria-hidden="true"></span>
  <a class="skip-link" href="#main">Skip to main content</a>

  <header class="site-header">
    <nav class="nav-bar" aria-label="Primary navigation">
      <a class="brand" href="index.html">
        <span class="brand-mark" aria-hidden="true">LS</span>
        <span class="brand-text">Luke Schwaninger</span>
      </a>
      <ul class="nav-links">
        <li><a href="projects.html">Projects</a></li>
        <li><a href="research.html">Research</a></li>
        <li><a href="experience.html">Experience</a></li>
        <li><a href="books.html">Books</a></li>
        <li><a href="social.html" aria-current="page">Social</a></li>
      </ul>
    </nav>
  </header>

  <main id="main" class="site-shell social-main">
    <header class="generic-header">
      <h1>Latest Updates</h1>
      <p>Selected activity from LinkedIn, Instagram, and Strava.</p>
    </header>

    <section>
      <div class="social-grid">
        <div class="social-card linkedin-card" data-aspect="1.65">
          <iframe
            src="https://www.linkedin.com/embed/feed/update/urn:li:share:7365088325348618241?collapsed=1"
            title="LinkedIn post"
            frameborder="0"
            allowfullscreen
            loading="lazy"
          ></iframe>
        </div>

        <div class="social-card">
          <blockquote
            class="instagram-media"
            data-instgrm-permalink="https://www.instagram.com/p/DNt-b5E4hrC/"
            data-instgrm-version="14"
            style="background:#fff; border:0; margin:0; padding:0; width:100%;">
            <a href="https://www.instagram.com/p/DNt-b5E4hrC/" target="_blank" rel="noopener"></a>
          </blockquote>
        </div>

        <div class="social-card">
          <blockquote class="instagram-media"
            data-instgrm-permalink="https://www.instagram.com/p/DHjxbgbSDd7/"
            data-instgrm-version="14"
            style="background:#fff; border:0; margin:0; padding:0; width:100%;">
            <a href="https://www.instagram.com/p/DHjxbgbSDd7/" target="_blank" rel="noopener"></a>
          </blockquote>
        </div>

        <div class="social-card">
          <blockquote class="instagram-media"
            data-instgrm-permalink="https://www.instagram.com/p/DQIF13IEiTo/"
            data-instgrm-version="14"
            style="background:#fff; border:0; margin:0; padding:0; width:100%;">
            <a href="https://www.instagram.com/p/DQIF13IEiTo/" target="_blank" rel="noopener"></a>
          </blockquote>
        </div>

        <div class="social-card">
          <div class="strava-embed-placeholder"
               data-embed-type="activity"
               data-embed-id="15574240396"
               data-style="standard"
               data-from-embed="false"></div>
        </div>

        <div class="social-card">
          <div class="strava-embed-placeholder"
               data-embed-type="activity"
               data-embed-id="15507294269"
               data-style="standard"
               data-from-embed="false"></div>
        </div>

        <div class="social-card">
          <div class="strava-embed-placeholder"
               data-embed-type="activity"
               data-embed-id="15493102061"
               data-style="standard"
               data-from-embed="false"></div>
        </div>
      </div>
    </section>

    <section class="return-section">
      <a href="index.html" class="return-button">
        <span class="return-icon" aria-hidden="true">&larr;</span>
        <span class="return-text">Return Home</span>
      </a>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Luke Schwaninger</p>
  </footer>

  <script src="https://strava-embeds.com/embed.js"></script>
  <script async src="https://www.instagram.com/embed.js"></script>

  <script>
    const pageHeader = document.querySelector('.site-header');
    let lastScroll = 0;
    window.addEventListener('scroll', () => {
      const currentScroll = window.scrollY;
      if (pageHeader) {
        if (currentScroll > lastScroll && currentScroll > 80) {
          pageHeader.classList.add('header-hidden');
        } else {
          pageHeader.classList.remove('header-hidden');
        }
      }
      lastScroll = currentScroll;
    });

    const processedFrames = new WeakSet();
    const linkedinFrames = new Set();

    function markCardLoaded(frame) {
      const card = frame.closest('.social-card');
      if (card) {
        card.classList.add('loaded');
      }
    }

    function resizeLinkedInFrame(frame) {
      const container = frame.closest('.linkedin-card');
      if (!container) return;

      const ratio = Number.parseFloat(container.dataset.aspect) || 1.65;
      const width = frame.offsetWidth;
      if (!width || Number.isNaN(ratio)) return;

      const height = Math.round(width * ratio);
      frame.style.height = `${height}px`;
    }

    function processFrame(frame) {
      if (processedFrames.has(frame)) return;
      processedFrames.add(frame);

      const isLinkedIn = frame.closest('.linkedin-card');
      
      frame.addEventListener('load', () => {
        if (isLinkedIn) {
          resizeLinkedInFrame(frame);
        }
        markCardLoaded(frame);
      });
      if (isLinkedIn) {
        linkedinFrames.add(frame);
        resizeLinkedInFrame(frame);
      }
    }

    function scanForFrames() {
      document.querySelectorAll('.social-card iframe').forEach(processFrame);
    }

    scanForFrames();

    window.addEventListener('resize', () => {
      linkedinFrames.forEach(resizeLinkedInFrame);
    });

    const embedObserver = new MutationObserver(scanForFrames);
    embedObserver.observe(document.body, { childList: true, subtree: true });

    function findFrameBySource(source) {
      return Array.from(document.querySelectorAll('.social-card iframe'))
        .find(frame => frame.contentWindow === source);
    }

    function applyEmbedHeight(frame, height) {
      if (!frame) return;
      const value = Number(height);
      if (!Number.isFinite(value)) return;

      frame.style.height = `${value}px`;
      markCardLoaded(frame);
    }

    window.addEventListener('message', event => {
      const frame = findFrameBySource(event.source);
      if (!frame) return;

      if (event.origin.includes('strava-embeds.com') && Array.isArray(event.data)) {
        const [, type, value] = event.data;
        if (type === 'BROADCAST_IFRAME_HEIGHT') {
          applyEmbedHeight(frame, value);
        }
      return;
      }

      if (event.origin.includes('instagram.com') && typeof event.data === 'string') {
        const payload = event.data.trim();
        if (!payload) return;

        try {
          const parsed = JSON.parse(payload);
          if (parsed?.type === 'MEASURE' && parsed?.details?.height) {
            applyEmbedHeight(frame, parsed.details.height);
          }
        } catch (error) {
          // Ignore malformed messages
        }
      }
    });

    function processInstagram() {
      if (window.instgrm && window.instgrm.Embeds) {
        window.instgrm.Embeds.process();
      }
    }

    window.addEventListener('load', processInstagram);

    const instaObserver = new MutationObserver(processInstagram);
    instaObserver.observe(document.body, { childList: true, subtree: true });

  </script>
</body>
</html>
